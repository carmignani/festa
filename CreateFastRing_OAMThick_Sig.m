function [fastring,fastringrad,esrfrad,OAM,Sig]=CreateFastRing_OAMThick_Sig(ring,RFVolt,hnum,nusp,filename)
%   [fastring,fastringrad,esrfrad,OAM,Sig]=CreateFastRing_OAM_Sig(ring,RFVolt,hnum)

indcav=findcells(ring,'Class','RFCavity');
cav=ring(indcav(1));
ring(indcav)=[];
ring=[cav;ring];
% esrf=ring;
ring=atsetcavity(ring,RFVolt,0,hnum);
[fastring,fastringrad]=atfastring(ring);
indlin=findcells(fastring,'FamName','lin_elem');
indlinrad=findcells(fastringrad,'FamName','lin_elem');
M66=fastring{indlin}.M66;
M66rad=fastringrad{indlinrad}.M66;
M66sympl=symplectify(M66);
M66symplrad=symplectify(M66rad);
fastring{indlin}.M66=M66sympl;
fastringrad{indlinrad}.M66=M66symplrad;
[esrfrad,RADINDEX,CAVINDEX,ENERGY]=atradon(ring);
esrfrad=atsetcavity(esrfrad,RFVolt,1,hnum);
OAM = OrbitAnglesMatrixThickWithSext( ring, nusp );
envelope=ohmienvelope(esrfrad,RADINDEX,1);
Sig=envelope.R;
%B=bmat(ring);
% M66sympl_nodisp=M66sympl;
% M66sympl_nodisp(1,3)=0;
% M66sympl_nodisp(1,4)=0;
% M66sympl_nodisp(1,5)=0;
% M66sympl_nodisp(1,6)=0;
% M66sympl_nodisp(2,3)=0;
% M66sympl_nodisp(2,4)=0;
% M66sympl_nodisp(2,5)=0;
% M66sympl_nodisp(2,6)=0;
% M66sympl_nodisp(3,1)=0;
% M66sympl_nodisp(3,2)=0;
% M66sympl_nodisp(3,5)=0;
% M66sympl_nodisp(3,6)=0;
% M66sympl_nodisp(4,1)=0;
% M66sympl_nodisp(4,2)=0;
% M66sympl_nodisp(4,5)=0;
% M66sympl_nodisp(4,6)=0;
% M66sympl_nodisp(5,1)=0;
% M66sympl_nodisp(5,2)=0;
% M66sympl_nodisp(5,3)=0;
% M66sympl_nodisp(5,4)=0;
% M66sympl_nodisp(6,1)=0;
% M66sympl_nodisp(6,2)=0;
% M66sympl_nodisp(6,3)=0;
% M66sympl_nodisp(6,4)=0;
% % M66sympl_nodisp
% M66symplrad_nodisp=M66symplrad;
% M66symplrad_nodisp(1,3)=0;
% M66symplrad_nodisp(1,4)=0;
% M66symplrad_nodisp(1,5)=0;
% M66symplrad_nodisp(1,6)=0;
% M66symplrad_nodisp(2,3)=0;
% M66symplrad_nodisp(2,4)=0;
% M66symplrad_nodisp(2,5)=0;
% M66symplrad_nodisp(2,6)=0;
% M66symplrad_nodisp(3,1)=0;
% M66symplrad_nodisp(3,2)=0;
% M66symplrad_nodisp(3,5)=0;
% M66symplrad_nodisp(3,6)=0;
% M66symplrad_nodisp(4,1)=0;
% M66symplrad_nodisp(4,2)=0;
% M66symplrad_nodisp(4,5)=0;
% M66symplrad_nodisp(4,6)=0;
% M66symplrad_nodisp(5,1)=0;
% M66symplrad_nodisp(5,2)=0;
% M66symplrad_nodisp(5,3)=0;
% M66symplrad_nodisp(5,4)=0;
% M66symplrad_nodisp(6,1)=0;
% M66symplrad_nodisp(6,2)=0;
% M66symplrad_nodisp(6,3)=0;
% M66symplrad_nodisp(6,4)=0;
% M66symplrad_nodisp=B*M66symplrad*inv(B);
% fastring{indlin}.M66=M66sympl_nodisp;
% fastringrad{indlinrad}.M66=M66symplrad_nodisp;
%save('neededvariablesSimpl.mat','esrfrad','fastring','fastringrad','Sig','OAM');
save([ filename '.mat' ],'esrfrad','fastring','fastringrad','Sig','OAM');
end 

